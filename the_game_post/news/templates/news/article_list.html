{% extends 'news/base.html' %}

{% block content %}
<div class="articles-header">
    <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏</h2>
    {% if current_tag %}
    <div class="current-tag">
        –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥—É: <span class="tag">{{ current_tag }}</span>
        <a href="{% url 'news:article_list' %}" class="clear-filter">√ó –û—á–∏—Å—Ç–∏—Ç—å</a>
    </div>
    {% endif %}
</div>

<div class="content-with-sidebar">
    <div class="main-content">
        {% for article in articles %}
        <article class="article-preview">
            <h3><a href="{% url 'news:article_detail' article.slug %}">{{ article.title }}</a></h3>
            <div class="article-meta">
                <span class="date">{{ article.created_at|date:"d.m.Y" }}</span>
                <span class="author">–ê–≤—Ç–æ—Ä: {{ article.author.username }}</span>
                <span class="views">üëÅ {{ article.views }}</span>
            </div>
            
            <div class="article-tags">
                {% for tag in article.tags.all %}
                <a href="{% url 'news:articles_by_tag' tag.slug %}" class="tag" style="background-color: {{ tag.color }}">
                    {{ tag.name }}
                </a>
                {% endfor %}
            </div>
            
            {% with first_block=article.blocks.first %}
                {% if first_block.block_type == 'text' %}
                    <p>{{ first_block.content|truncatewords:30 }}</p>
                {% elif first_block.block_type == 'image' and first_block.image %}
                    <img src="{{ first_block.image.url }}" alt="{{ first_block.image_caption }}" class="preview-image">
                {% endif %}
            {% endwith %}
            
            <a href="{% url 'news:article_detail' article.slug %}" class="read-more">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ</a>
        </article>
        {% empty %}
        <p>–ü–æ–∫–∞ –Ω–µ—Ç —Å—Ç–∞—Ç–µ–π.</p>
        {% endfor %}
    </div>
    
    <aside class="sidebar">
        <div class="tags-cloud">
            <h3>–¢–µ–≥–∏</h3>
            <div class="tags-list">
                {% for tag in all_tags %}
                <a href="{% url 'news:articles_by_tag' tag.slug %}" class="tag" style="background-color: {{ tag.color }}">
                    {{ tag.name }}
                </a>
                {% endfor %}
            </div>
        </div>
    </aside>
</div>
{% endblock %}