{% extends 'news/base.html' %}

{% block title %}
    {% if current_category %}
        {% if current_category.slug == 'novosti' %}–ù–æ–≤–æ—Å—Ç–∏
        {% elif current_category.slug == 'igry' %}–ò–≥—Ä—ã
        {% elif current_category.slug == 'stati' %}–°—Ç–∞—Ç—å–∏
        {% else %}{{ current_category.name }}
        {% endif %}
    {% else %}
        –í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏
    {% endif %}
{% endblock %}

{% block content %}
<div class="articles-header">
    <h2>
        {% if current_category %}
            {% if current_category.slug == 'novosti' %}–ù–æ–≤–æ—Å—Ç–∏
            {% elif current_category.slug == 'igry' %}–ò–≥—Ä—ã
            {% elif current_category.slug == 'stati' %}–°—Ç–∞—Ç—å–∏
            {% else %}{{ current_category.name }}
            {% endif %}
        {% else %}
            –í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏
        {% endif %}
    </h2>
    
    {% if current_tag %}
    <div class="current-tag">
        –§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥—É: <span class="tag">{{ current_tag }}</span>
        <a href="{% if current_category %}{% url 'news:articles_by_category' current_category.slug %}{% else %}{% url 'news:article_list' %}{% endif %}" class="clear-filter">√ó –û—á–∏—Å—Ç–∏—Ç—å</a>
    </div>
    {% endif %}
</div>

<div class="content-with-sidebar">
    <div class="main-content">
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ -->
        <div class="pagination-info">
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ articles.number }} –∏–∑ {{ articles.paginator.num_pages }}
            {% if current_category or current_tag %}
                ‚Ä¢ {{ articles.paginator.count }} —Å—Ç–∞—Ç–µ–π
            {% endif %}
        </div>

        {% for article in articles %}
        <article class="article-preview">
            <div class="article-preview-header">
                {% if article.thumbnail %}
                <div class="article-thumbnail">
                    <img src="{{ article.thumbnail.url }}" alt="{{ article.title }}" class="thumbnail-image">
                </div>
                {% endif %}
                
                <div class="article-preview-content">
                    <h3><a href="{% url 'news:article_detail' article.slug %}">{{ article.title }}</a></h3>
                    
                    <div class="article-meta">
                        <span class="date">{{ article.created_at|date:"d.m.Y" }}</span>
                        <span class="author">–ê–≤—Ç–æ—Ä: {{ article.author.username }}</span>
                        <span class="views">üëÅ {{ article.views }}</span>
                        <span class="comments-count">üí¨ {{ article.get_comments_count }}</span>
                    </div>
                    
                    <div class="article-tags">
                        {% for tag in article.tags.all %}
                        <a href="{% url 'news:articles_by_tag' tag.slug %}" class="tag" style="background-color: {{ tag.color }}">
                            {{ tag.name }}
                        </a>
                        {% endfor %}
                    </div>
                    
                    <a href="{% url 'news:article_detail' article.slug %}" class="read-more">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ</a>
                </div>
            </div>
        </article>
        {% empty %}
        <p>–ü–æ–∫–∞ –Ω–µ—Ç —Å—Ç–∞—Ç–µ–π –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.</p>
        {% endfor %}

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        {% if articles.paginator.num_pages > 1 %}
        <div class="pagination">
            {% if articles.has_previous %}
                <a href="?page=1{% if current_tag %}&tag={{ current_tag }}{% endif %}">¬´ –ü–µ—Ä–≤–∞—è</a>
                <a href="?page={{ articles.previous_page_number }}{% if current_tag %}&tag={{ current_tag }}{% endif %}">‚Äπ –ù–∞–∑–∞–¥</a>
            {% else %}
                <span class="disabled">¬´ –ü–µ—Ä–≤–∞—è</span>
                <span class="disabled">‚Äπ –ù–∞–∑–∞–¥</span>
            {% endif %}

            {% for num in articles.paginator.page_range %}
                {% if articles.number == num %}
                    <span class="current">{{ num }}</span>
                {% elif num > articles.number|add:'-3' and num < articles.number|add:'3' %}
                    <a href="?page={{ num }}{% if current_tag %}&tag={{ current_tag }}{% endif %}">{{ num }}</a>
                {% endif %}
            {% endfor %}

            {% if articles.has_next %}
                <a href="?page={{ articles.next_page_number }}{% if current_tag %}&tag={{ current_tag }}{% endif %}">–í–ø–µ—Ä—ë–¥ ‚Ä∫</a>
                <a href="?page={{ articles.paginator.num_pages }}{% if current_tag %}&tag={{ current_tag }}{% endif %}">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</a>
            {% else %}
                <span class="disabled">–í–ø–µ—Ä—ë–¥ ‚Ä∫</span>
                <span class="disabled">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</span>
            {% endif %}
        </div>
        {% endif %}
    </div>
    
    <aside class="sidebar">
        <div class="tags-cloud">
            <h3>–¢–µ–≥–∏</h3>
            <div class="tags-list">
                {% for tag in all_tags %}
                <a href="{% url 'news:articles_by_tag' tag.slug %}" class="tag" style="background-color: {{ tag.color }}">
                    {{ tag.name }}
                </a>
                {% endfor %}
            </div>
        </div>
    </aside>
</div>
{% endblock %}