{% extends 'news/base.html' %}

{% block title %}{{ article.title }}{% endblock %}

{% block content %}
<div class="content-with-sidebar">
    <div class="main-content">
        <article class="news-article">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <header class="article-header">
                <h1>{{ article.title }}</h1>
                <div class="article-meta">
                    <span class="date">{{ article.created_at|date:"d.m.Y H:i" }}</span>
                    <span class="author">–ê–≤—Ç–æ—Ä: {{ article.author.username }}</span>
                    <span class="views">üëÅ {{ article.views }}</span>
                    <span class="comments-count">üí¨ {{ article.get_comments_count }}</span>
                </div>
                
                <div class="article-tags">
                    {% for tag in article.tags.all %}
                    <a href="{% url 'news:articles_by_tag' tag.slug %}" class="tag" style="background-color: {{ tag.color }}">
                        {{ tag.name }}
                    </a>
                    {% endfor %}
                </div>
            </header>

            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç–∞—Ç—å–∏ -->
            <section class="article-content">
                {% for block in article.blocks.all %}
                    {% if block.block_type == 'text' %}
                        <div class="text-block">
                            {{ block.content|linebreaks }}
                        </div>
                    
                    {% elif block.block_type == 'image' and block.image %}
                        <div class="image-block">
                            <img src="{{ block.image.url }}" alt="{{ block.image_caption }}" class="article-image">
                            {% if block.image_caption %}
                                <p class="image-caption">{{ block.image_caption }}</p>
                            {% endif %}
                        </div>
                    {% endif %}
                {% endfor %}
            </section>
        </article>

        <!-- –°–µ–∫—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
        <section class="comments-section">
            <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ article.get_comments_count }})</h3>
            
            {% if article.comments_enabled %}
                <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                {% if user.is_authenticated %}
                <div class="comment-form">
                    <h4>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h4>
                    <form method="post" class="comment-form">
                        {% csrf_token %}
                        {{ comment_form.parent }}
                        <div class="form-group">
                            {{ comment_form.content }}
                        </div>
                        <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
                    </form>
                </div>
                {% else %}
                <div class="auth-required">
                    <p>–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è <a href="{% url 'admin:login' %}">–≤–æ–π–¥–∏—Ç–µ</a> –≤ —Å–∏—Å—Ç–µ–º—É.</p>
                </div>
                {% endif %}

                <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
                <div class="comments-list">
                    {% for comment in comments %}
                        {% include 'news/comment.html' with comment=comment %}
                    {% empty %}
                    <p class="no-comments">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
                    {% endfor %}
                </div>
            {% else %}
                <div class="comments-disabled">
                    <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ –æ—Ç–∫–ª—é—á–µ–Ω—ã.</p>
                </div>
            {% endif %}
        </section>

        <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ -->
        {% if popular_articles %}
        <div class="popular-articles">
            <h3>–°–∞–º—ã–µ —á–∏—Ç–∞–µ–º—ã–µ</h3>
            <div class="popular-list">
                {% for popular in popular_articles %}
                <div class="popular-item">
                    <a href="{% url 'news:article_detail' popular.slug %}">{{ popular.title }}</a>
                    <span class="views">üëÅ {{ popular.views }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="article-actions">
            <a href="{% url 'news:article_list' %}" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É —Å—Ç–∞—Ç–µ–π</a>
        </div>
    </div>
    
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <aside class="sidebar">
        <div class="tags-cloud">
            <h3>–í—Å–µ —Ç–µ–≥–∏</h3>
            <div class="tags-list">
                {% for tag in all_tags %}
                <a href="{% url 'news:articles_by_tag' tag.slug %}" class="tag" style="background-color: {{ tag.color }}">
                    {{ tag.name }}
                </a>
                {% endfor %}
            </div>
        </div>
    </aside>
</div>
{% endblock %}

<script>
function showReplyForm(commentId) {
    document.getElementById('reply-form-' + commentId).style.display = 'block';
}

function hideReplyForm(commentId) {
    document.getElementById('reply-form-' + commentId).style.display = 'none';
}

// –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—é –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
if (window.location.hash) {
    const commentElement = document.getElementById(window.location.hash.substring(1));
    if (commentElement) {
        commentElement.scrollIntoView({ behavior: 'smooth' });
    }
}
</script>